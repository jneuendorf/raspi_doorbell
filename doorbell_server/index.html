<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>

<script type="text/javascript">
    let volume, websocket, slider

    const messageTypes = {
        "request_volume": "volume:request",
        "requestVolume": "volume:request",
        "receive_volume": "volume:receive",
        "receiveVolume": "volume:receive",
        "update_volume": "volume:update",
        "updateVolume": "volume:update",

        "receive_bell": "bell:receive",
        "receiveBell": "bell:receive"
    }


    const handleMessage = message => {
        try {
            message = JSON.parse(message)
        }
        catch (error) {
            console.log('received invalid message', message)
            message = null
        }
        if (message) {
            const {type, ...payload} = message
            if (type === messageTypes.receiveVolume) {
                volume = payload.volume
                slider.value = volume
            }
            /* else if (type === messageTypes.receiveBell) {
                alert('Ring')
            } */
        }
    }

    websocket = new WebSocket('ws://192.168.2.169:8888/websocket')
    websocket.onopen = () => {
        websocket.send(JSON.stringify({type: messageTypes.requestVolume}))
    }
    websocket.onmessage = (event) => {
        handleMessage(event.data)
    }
    websocket.onerror = (error) => {
        console.error(error)
    }
    websocket.onclose = (event) => {
        console.log(event.code, event.reason)
    }
</script>

<div>
    <span>Volume</span>
    <input
        type='range'
        min='0'
        max='1'
        step='any'
    />
</div>

<script type="text/javascript">
    slider = document.querySelector('input[type="range"]')
    slider.addEventListener('change', event => {
        websocket.send(JSON.stringify({
            type: messageTypes.updateVolume,
            volume: parseFloat(event.target.value),
        }))
    })
</script>

</body>
</html>
