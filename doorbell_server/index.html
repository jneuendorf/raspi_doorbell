<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>

<script type="text/javascript">
    let volume, websocket

    const slider = document.querySelector('input[type="range"]')
    slider.addEventListener('change', event => {
        websocket.send(JSON.stringify({
            type: messageTypes.updateVolume,
            volume: event.target.value
        }))
    })

    const messageTypes = {
        "request_volume": "volume:request",
        "requestVolume": "volume:request",
        "receive_volume": "volume:receive",
        "receiveVolume": "volume:receive",
        "update_volume": "volume:update",
        "updateVolume": "volume:update",

        "receive_bell": "bell:receive",
        "receiveBell": "bell:receive"
    }


    const handleMessage = message => {
        try {
            message = JSON.parse(message)
        }
        catch (error) {
            console.log('received invalid message', message)
            message = null
        }
        if (message) {
            const {type, ...payload} = message
            if (type === messageTypes.receiveVolume) {
                volume = payload.volume
                slider.value = volume
            }
            /* else if (type === messageTypes.receiveBell) {
                alert('Ring')
            } */
        }
    }

    websocket = new WebSocket('ws://192.168.2.169:8888/websocket')
    websocket.onopen = () => {
        websocket.send(JSON.stringify({type: messageTypes.requestVolume}))
    }
    websocket.onmessage = (event) => {
        handleMessage(event.data)
    }
    websocket.onerror = (error) => {
        console.error(error)
    }
    websocket.onclose = (event) => {
        console.log(event.code, event.reason)
    }
</script>

<div>
    <span>Volume</span>
    <input
        type='range'
        min='0'
        max='1'
        step='any'
    />
</div>

<!-- <script type="text/javascript">
    var ws = new WebSocket("ws://localhost:8888/websocket");
    /* var username = prompt("What's your name?"); */

    /* function sendMessage() {
        var messageInput = document.getElementById("message");
        var message = messageInput.value;
        var payload = {
            "message": message,
            "user": username
        }
        // Make the request to the WebSocket.
        ws.send(JSON.stringify(payload));
        // Clear the message from the input.
        messageInput.value = "";
        return false;
    } */

    ws.onmessage = function(evt) {
        console.log(evt.data)
        /* var messageDict = JSON.parse(evt.data);
        // Create a div with the format `user: message`.
        var messageBox = document.createElement("div");
        messageBox.innerHTML = messageDict.user + ": " + messageDict.message;
        document.getElementById("messages").appendChild(messageBox); */
    };
</script>
<script type="text/javascript" src="/static/index.js"></script> -->

</body>
</html>
